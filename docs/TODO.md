### 機能仕様書作成 TODOリスト

**最優先**
- [x] `CTR-001` 契約書・重説の自動生成（ハトサポ連携）
- [x] `AUTH-001` ユーザー認証・ログイン機能

**高**
- [x] `OB-001` Ordinance Bot（法令・条例リサーチ）
- [x] `LCP-001` 法令CI/CDパイプライン（バックエンド）
- [x] `DSH-001` 案件ダッシュボード
- [x] `REP-001` 物件概要書（募集資料）の生成
- [x] `CON-001` レインズ連携（アットホーム経由）

**中**
- [x] `MIG-001` データ移行ウィザード（CSVインポート）
- [x] `REP-002` 査定書の生成
- [x] `CON-002` 不動産ポータルサイト連携

**低**
- [x] `CRM-001` 軽量CRM（顧客管理・追客）機能
- [x] `API-001` 外部連携用 公開API 

# 管理系機能仕様書作成 TODOリスト（新規追加）

## Phase 3: サービス運営・管理機能の仕様書作成

**α版スコープ（システム基盤として必要）**
- [x] `TNT-001` テナント管理機能
  - テナント作成・削除、設定管理
  - データ分離、アクセス制御
  - α版：基本的なテナント分離機能
- [x] `SUB-001` サブスクリプション管理機能
  - プラン管理（α版は無料プランのみ）
  - 機能制限・使用量管理
  - α版：無料プラン設定、将来の課金準備
- [x] `ADM-001` システム管理機能
  - 管理者画面、システム設定
  - ユーザー管理、権限管理
  - α版：基本的な管理機能
- [x] `MON-001` 使用量監視・制限機能
  - リソース使用量監視
  - 制限値管理・アラート
  - α版：システム保護のための基本監視
- [x] `SUP-001` サポート・問い合わせ管理機能
  - 問い合わせフォーム、チケット管理
  - FAQ、ヘルプドキュメント
  - α版：基本的な問い合わせ機能

**β版スコープ（運用強化）**
- [ ] `LOG-001` ログ・監視ダッシュボード機能
  - システムログ監視
  - 運用ダッシュボード
- [ ] `NOT-001` 通知・アラート管理機能
  - システム通知
  - アラート配信・管理

**RC版スコープ（運用完成）**
- [ ] `BCK-001` バックアップ・復旧管理機能
  - データバックアップ自動化
  - 災害復旧機能

## Phase 4: リリーススコープドキュメント更新
- [x] `release_scope.md` 更新
  - α版・β版・RC版のスコープ明確化
  - 管理系機能の追加反映

# 技術選定確定タスク（完了）

## Phase 5: AI駆動開発を前提とした技術スタック確定

**技術スタック確定（shadcn/ui + Claude Code対応）**
- [x] **フロントエンド技術スタック確定**
  - React.js + Next.js 14（App Router）への統一 ✅
  - TypeScript採用確定 ✅
  - shadcn/ui + Tailwind CSS採用確定 ✅
  - 状態管理ライブラリ選定（Zustand採用決定） ✅
- [x] **バックエンド技術スタック確定**
  - Node.js + TypeScript + Fastify（メイン API）✅
  - Python + FastAPI（AI処理ワーカー専用）✅
  - API設計方針（tRPC メイン + REST 外部連携）✅
- [x] **開発ツール・環境確定**
  - Claude Code対応のための開発環境構成 ✅
  - Linting/Formatting設定（ESLint + Prettier）✅
  - 開発効率化ツール選定（pnpm + Turborepo）✅
- [x] **インフラ・デプロイ選定確定**
  - Vercel（フロントエンド）+ Cloud Run（API・ワーカー）✅
  - 将来拡張でKubernetes対応検討 ✅
  - CI/CD パイプライン最適化（GitHub Actions）✅

**ドキュメント更新タスク**
- [x] `システム仕様書.md` の技術スタック部分更新 ✅
- [x] 各機能仕様書の技術的詳細更新
  - [x] DSH-001（ダッシュボード）shadcn/ui + tRPC対応 ✅
  - [x] UF-001（Unified Form）React Hook Form + Zod対応 ✅
  - [ ] 他の機能仕様書の段階的更新（継続作業）
- [x] 新規作成: `技術選定根拠書.md` ✅
- [x] 新規作成: `開発環境構築ガイド.md`（Claude Code対応）✅

# 機能仕様書 v1.2 -> v1.3 アップデートタスク

## Phase 1: 個別機能仕様書の詳細化 (ガードレール値の追記)

- [x] **OCR-001**:
  - [x] ファイル保存時の暗号化方式を明記 (例: SSE-S3)
  - [x] 同時10job超過時のキューイング/リジェクト方針を定義
- [x] **API-001**:
  - [x] OAuth2スコープ設計を追記 (例: `read:properties`, `write:properties`)
  - [x] Webhookの再送ポリシーを定義 (リトライ回数, 指数バックオフ)
- [x] **AUTH-001**:
  - [x] パスワード有効期限/ローテーションポリシーを明記
  - [x] セッション有効期間 (Idle/Absolute) の数値を定義
- [x] **CON-001**:
  - [x] アットホームAPIのレートリミット上限を明記
  - [x] レインズ仕様変更時のSLAを定義 (例: 72h以内パッチ提供)
- [x] **CON-002**:
  - [x] 画像アップロード上限 (枚数, MB) をサイト別に表で記載
  - [x] RPAヘルスチェックの失敗閾値と自動無効化条件を定義
- [x] **CRM-001**:
  - [x] 顧客情報の削除/匿名化フローを具体化
  - [x] タスク通知の配信チャネルの優先順位を定義 (メール > アプリ内通知)
- [x] **CTR-001**:
  - [x] RPA実行コンテナの同時起動上限とスケール指標を定義
  - [x] ハトサポ側CAPTCHA/MFA変動時のバイパス策を検討・追記
- [x] **DSH-001**:
  - [x] 通知のリアルタイム化（WebSocket or SSE）要否の判断
- [x] **MIG-001**:
  - [x] エラー発生時のロールバック指針を明確化 (失敗行のみ vs 全トランザクション)
  - [x] CSVの最大行数/ファイルサイズの制約を明記
- [x] **OB-001**:
  - [x] LLM出力の根拠条文の引用方式を定義
  - [x] 信頼度スコアの簡易的な算出ロジックを追記
- [x] **UF-001**:
  - [x] PUT/POST時のJSONペイロードサイズ上限を定義 (例: 1MB)
  - [x] 悲観ロックの自動解放時間 (TTL) を定義
- [x] **LCP-001**:
  - [x] 法改正適用のSLOを分布で宣言 (例: 90パーセンタイルで12時間以内)
  - [x] GitHub Actionsの同時実行上限について言及
- [x] **REP-001**:
  - [x] 画像サイズ/解像度の上限を具体的に定義 (例: 10MB, 4096x4096px)
  - [x] プレビューとPDFの差分テストの合格基準を定義 (例: ピクセル差3%未満)
- [x] **REP-002**:
  - [x] 主要LLM障害時のフォールバックモデルについて方針を追記
  - [x] AIが生成したログの保持期間を定義 (PIIを考慮)

## Phase 2: 横断的アーキテクチャ方針の策定

- [x] **新規作成: `docs/architecture/` ディレクトリ**
- [x] **新規作成: `非機能要件一覧.md`**
  - [x] 可用性 (例: 99.5%)
  - [x] RPO/RTO (例: RPO=1h, RTO=4h)
  - [x] ペネトレーションテストの頻度 (例: 年1回)
- [x] **新規作成: `監査ログポリシー.md`**
  - [x] ログの保持期間を定義 (例: 5年)
  - [x] S3 Glacier等への自動アーカイブ方針
  - [x] ログの検索要件（誰が、何をキーに検索できるか）
- [x] **既存修正: `AUTH-001`へのRBAC集約**
  - [x] RBACのロール定義を`AUTH-001`に完全に集約
  - [x] 他の仕様書からはこの定義を参照するように修正
- [x] **新規作成: `マルチテナント方式.md`**
  - [x] DB分離レベルの方針 (Shared-DB vs Schema-per-tenant) を決定
- [x] **新規作成: `多言語対応方針.md`**
  - [x] 将来的な多言語対応を見据えたデータモデルやUIの考慮点を記載
- [x] **新規作成: `api/metrics.md`**
  - [x] Prometheus等で収集する主要メトリクスの命名規則と一覧を定義

---
### 完了済みタスク

- 機能仕様書 v1.1 -> v1.2 へのアップデート
  - 全14件の機能仕様書に対して、フィードバックに基づく修正を実施
- 機能仕様書リストにない仕様書(2件)の作成
- TODOリストの作成と管理
- 全機能仕様書(14件)の新規作成 

### 機能仕様書改訂（フィードバック反映）

- [x] `API-001`: レートリミット、RBAC参照の追加
- [x] `AUTH-001`: MFA/SSO、アカウントロックアウト、RBAC定義の追加
- [x] `CON-001`: リスクと対策、データマッピング、セキュリティ要件の具体化
- [x] `CON-002`: リスクと対策、データマッピング、セキュリティ要件の具体化
- [x] `CRM-001`: データ項目、プライバシー、検索機能の具体化
- [x] `CTR-001`: テンプレート管理、データ連携、エラーハンドリングの具体化
- [x] `DSH-001`: 表示項目、カスタマイズ性、パフォーマンス要件の具体化
- [x] `LCP-001`: パイプラインのトリガー、テスト項目、通知仕様の具体化
- [x] `MIG-001`: 対応フォーマット、バリデーションルール、エラーレポートの具体化
- [x] `OB-001`: （ユーザーによる更新を反映済み）
- [x] `REP-001`: デザインテンプレート、データ項目、出力形式の具体化
- [x] `REP-002`: 査定ロジック、データソース、算出根拠の明示 

### 🔧 **開発・運用改善事項**
- [x] **法令CI/CD通知設定をSlackからメールに変更**
  - LCP-001機能仕様書更新（通知方式変更）
  - リリーススコープ更新（Alpha版記載調整）
- [x] **海外展開方針の明確化**
  - 多言語対応方針を「検討段階・Phase 1基盤準備のみ」に調整
  - UF-001国際化対応を「技術的基盤の準備のみ」に調整
- [x] **長期リリーススコープの策定**
  - RC版・正式版・将来拡張計画をrelease_scope.mdに追加
  - 成功指標（KPI）・技術的負債対応計画を明記

### 🔄 **RC版・クラウドサービス統一作業**
- [x] **各機能仕様書へのRC版情報追加**
  - [x] UF-001, OCR-001, DSH-001, REP-001のRC版要件追加（完了）
  - [x] **Phase 1: 主要機能** - REP-002, OB-001, CTR-001のRC版要件追加
  - [x] **Phase 2: 連携機能** - CON-001, CON-002, MIG-001のRC版要件追加  
  - [x] **Phase 3: CI/CD・API** - LCP-001, API-001のRC版要件追加
  - [x] **Phase 4: 管理機能** - ADM-001, MON-001, SUP-001のRC版要件追加（TNT-001, SUB-001は対応済み）
- [x] **Google Cloud統一対応**
  - [x] 監査ログポリシーをAWSからGoogle Cloud Loggingに変更
  - [x] マルチテナント方式のAWS参照をGoogle Cloudサービスに変更
  - [x] 開発環境構築ガイドのAWS認証情報をGoogle Cloud対応に変更
  - [x] 技術選定根拠書のクラウドサービス対応表をGoogle Cloud中心に更新

# システム図・UMLダイアグラム追加作業

## Phase 1: 主要機能のダイアグラム作成（重要度：高）✅

- [x] **REP-002 (査定書生成)**: 
  - [x] AI査定処理フローチャート（mermaid flowchart）
  - [x] 査定システム・外部API連携シーケンス図（mermaid sequenceDiagram）
  - [x] 査定データ構造図（mermaid erDiagram）
- [x] **OB-001 (法令調査Bot)**:
  - [x] 法令調査システム構成図（mermaid graph）  
  - [x] 調査・監視・通知フローチャート（mermaid flowchart）
  - [x] 自治体サイト連携シーケンス図（mermaid sequenceDiagram）
- [x] **CTR-001 (契約書生成)**:
  - [x] 契約書生成処理フローチャート（mermaid flowchart）
  - [x] ハトサポ連携シーケンス図（mermaid sequenceDiagram）
  - [x] テンプレート管理システム構成図（mermaid graph）

## Phase 2: 連携機能のダイアグラム作成（重要度：高）✅

- [x] **CON-001 (レインズ連携)**:
  - [x] レインズ・アットホーム連携システム構成図（mermaid graph）
  - [x] 物件登録・同期フローチャート（mermaid flowchart）
  - [x] データ変換・マッピングシーケンス図（mermaid sequenceDiagram）
- [x] **CON-002 (ポータル連携)**:
  - [x] 複数ポータル連携システム構成図（mermaid graph）
  - [x] RPA・API連携フローチャート（mermaid flowchart）
  - [x] エラー処理・リトライシーケンス図（mermaid sequenceDiagram）
- [x] **MIG-001 (データ移行)**:
  - [x] データ移行処理フローチャート（mermaid flowchart）
  - [x] CSV解析・変換・検証シーケンス図（mermaid sequenceDiagram）
  - [x] データ構造・マッピング関係図（mermaid erDiagram）

## Phase 3: API・CI/CDのダイアグラム作成（重要度：中）✅

- [x] **LCP-001 (法令CI/CD)**:
  - [x] 法令監視・CI/CDパイプライン全体構成図（mermaid graph）
  - [x] 法令変更検知・自動更新フローチャート（mermaid flowchart）
  - [x] パイプライン実行・通知シーケンス図（mermaid sequenceDiagram）
- [x] **API-001 (公開API)**:
  - [x] 公開API全体アーキテクチャ図（mermaid graph）
  - [x] 認証・認可フローチャート（mermaid flowchart）
  - [x] API利用・レスポンス・エラー処理シーケンス図（mermaid sequenceDiagram）

## Phase 4: 管理機能のダイアグラム作成（重要度：中）

- [ ] **ADM-001 (システム管理)**:
  - [ ] マルチテナント管理システム構成図（mermaid graph）
  - [ ] ユーザー・権限管理フローチャート（mermaid flowchart）
  - [ ] RBAC権限体系図（mermaid classDiagram）
- [ ] **MON-001 (使用量監視)**:
  - [ ] 監視・アラートシステム構成図（mermaid graph）
  - [ ] リソース使用量監視フローチャート（mermaid flowchart）
  - [ ] AI予測・自動制御シーケンス図（mermaid sequenceDiagram）
- [ ] **SUP-001 (サポート管理)**:
  - [ ] サポートチケット管理フローチャート（mermaid flowchart）
  - [ ] AI自動応答・エスカレーションシーケンス図（mermaid sequenceDiagram）
  - [ ] 問い合わせ分類・処理システム構成図（mermaid graph）

## Phase 5: 統合・アーキテクチャ図作成（重要度：低）

- [ ] **全体システム構成図**: 
  - [ ] 不動産売買システム全体構成図（mermaid graph）
  - [ ] Google Cloudサービス連携図（mermaid graph）
  - [ ] データフロー全体図（mermaid flowchart）

---

**図表作成ガイドライン**:
- **図表形式**: mermaid記法優先（GitHub・Markdownネイティブ対応）
- **配置位置**: 各機能仕様書の「システム構成」セクション内
- **品質基準**: 図表の可読性・正確性・保守性を重視
- **更新方針**: 仕様変更時の図表同期更新を前提とした設計 

# レビューコメント対応（追加修正項目）

## Phase 6: ドキュメント品質向上（review_comments.md対応）

**中優先度**
- [x] **api/metrics.md**
  - バージョン管理・改訂履歴の追加
  - SLO/SLA数値設定の明確化（95th レイテンシ 500ms等）
  - 目標値と仕様の整合性確認

- [x] **release_scope.md**
  - クリティカルパスとリスクバッファの記載
  - ガントチャート図の追加
  - マイルストーン管理の詳細化

**高優先度**
- [x] **DSH-001 案件ダッシュボード**
  - 成約率KPI定義の分母/分子明確化
  - 他のKPI（案件進捗率等）の計算式検証
  - KPI定義の統一性確保

**完了予定**: 2025-06-30 ✅ **完了**

---

## 📋 **作業履歴**

### 2025-06-30 実施済み
- review_comments.md に基づく大部分の修正項目完了
- 優先度[高]項目の修正完了
- 各architecture配下ファイルの品質向上完了

### 2025-06-30 追加完了
- **api/metrics.md**: バージョン管理追加、SLO/SLA数値設定（95thレイテンシ500ms、可用性99.9%等）
- **release_scope.md**: クリティカルパス分析、リスクバッファ設定、Mermaidガントチャート図追加
- **DSH-001**: 成約率・案件進捗率のKPI定義で分母/分子を明確化（計算式レベル）

### 2025-06-30 システム仕様書 v2.0 大幅改訂完了
- **マークダウン記法修正**: エスケープシーケンス修正、リスト・テーブル記法統一、見出しレベル調整
- **バージョン管理追加**: v1.0～v2.0の改訂履歴テーブル追加
- **機能要件大幅充実化**: 
  - 全機能に【中長期】計画追加（AIベース分析、自動化機能等）
  - 管理系機能6項目追加（TNT-001, SUB-001, ADM-001, MON-001, SUP-001, API-001）
  - 各機能仕様書の詳細内容統合
- **非機能要件詳細化**: 
  - 性能要件（レスポンスタイム・スループット・負荷想定）
  - 可用性・信頼性（99.9%、RTO4h、冗長化戦略）
  - セキュリティ要件（TLS1.3、AES-256、監査ログ5年保管）
  - 運用・保守性（24/7監視、BCP、多言語対応）
- **運用・保守強化**: 監視体制・障害対応フロー・R&R詳細化
- **リスク管理強化**: リスクマトリクス・BCP・復旧優先順位明確化

## ✅ **レビューコメント対応完了サマリー**

**対応完了項目数**: 全指摘項目を100%対応
- ✅ 優先度[高]項目：全て完了
- ✅ 優先度[中]項目：全て完了  
- ✅ バージョン管理：11ファイル追加完了
- ✅ 技術仕様詳細化：定量的指標・成功基準追加
- ✅ 運用面考慮：コスト見積もり・SLA設定完了
- ✅ システム仕様書リファクタリング：v1.4→v2.0大幅改訂完了

**システム仕様書 v2.0 改訂内容**:
- 📝 **可読性向上**: マークダウン記法統一、構造化改善
- 🔧 **機能拡充**: 14→20機能（管理系6機能追加）、中長期計画全追加
- 🛡️ **品質強化**: 非機能要件詳細化、運用・保守体制確立
- 🎯 **実装指針**: スピード感と厳密性・安全性の両立実現 

# システム仕様書 リファクタリング・充実化

## Phase 7: システム仕様書 v1.4 → v2.0 大幅改訂

**最高優先度**
- [x] **マークダウン記法の修正**
  - エスケープシーケンス（`\`）の修正
  - テーブル記法の統一・修正
  - リスト記法の統一（`-`に統一）
  - インデントの統一
  - 見出しレベルの調整

- [x] **バージョン管理・改訂履歴の追加**
  - 文書のメタ情報統一
  - これまでの主要変更履歴の記録

**高優先度**
- [x] **機能要件の充実化**
  - 【中長期】計画の大幅追加
  - 各機能仕様書からの詳細内容統合
  - 管理系機能（TNT-001, SUB-001, ADM-001, MON-001, SUP-001）の追加
  - API機能（API-001）の詳細化

- [x] **非機能要件の最新化**
  - `非機能要件一覧.md`からの内容統合
  - SLO/SLA数値の統一
  - セキュリティ要件の詳細化（監査ログポリシー反映）

**中優先度** 
- [x] **アーキテクチャ情報の更新**
  - `技術選定根拠書.md`からの情報統合
  - マルチテナント方式の詳細追加
  - 多言語対応方針の反映

- [x] **運用・保守要件の詳細化**
  - `api/metrics.md`の監視要件統合
  - リスク管理の強化
  - 障害対応フローの詳細化

**完了予定**: 2025-06-30 ✅ **完了**

--- 