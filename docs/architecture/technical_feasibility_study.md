### **技術的実現可能性の検証（PoC）計画 v1.1**

**文書ID:** `ARC-006`
**文書名:** `技術的実現可能性の検証（Proof of Concept）計画`

| Ver | 日付 | 作成 / 変更者 | 変更概要 |
|-----|------|---------------|----------|
| 1.0 | 2025-06-30 | システム管理者 | 初版作成 |
| 1.1 | 2025-06-30 | システム管理者 | バージョン管理追加、各PoC成功基準（Exit Criteria）追記 |

---

### 1. はじめに

本ドキュメントは、Alpha版の開発に着手する前に、技術的なリスクが高いと想定される領域について、その実現可能性を検証するための小規模なプロトタイピング（PoC: Proof of Concept）計画を定義するものである。

PoCの目的は、未知の課題を早期に発見し、技術的な実現性を確認することで、開発フェーズにおける手戻りや予期せぬ遅延を防ぐことにある。

---

### 2. 検証対象とPoCテーマ

以下の4つの領域を、特に技術的リスクが高い領域と特定し、PoCを実施する。

**実施期間:** 各PoC 2-4週間（計10-16週間）
**実施体制:** 技術者2名 + 業務検証担当1名
**予算:** 総額500万円（人件費・外部サービス利用料込み）

#### **PoC-1: RPA連携の安定性検証**

- **対象機能:** `CTR-001` (ハトサポ連携), `CON-002` (ポータルサイトRPA連携)
- **実施期間:** 4週間（最高リスク項目のため最長期間を設定）
- **目的:** RPAが外部サイトのUI変更に対してどの程度脆弱であるか、また、安定運用に必要な対策は何かを具体的に把握する。
- **検証項目:**
    1.  **ログインプロセスの確立:**
        - Playwright等のHeadless Chromeライブラリを用いて、ハトサポBBのログインページを突破できるか検証する。ID/パスワード入力、ログインボタンクリックといった一連の操作を自動化する。
    2.  **CAPTCHA/MFAの存在確認:**
        - ログインプロセスや主要な操作画面に、人間による操作を要求するCAPTCHAや、二要素認証（MFA）が存在しないか確認する。存在する場合、RPAによる自動化は原則不可能と判断する。
    3.  **セレクタの堅牢性評価:**
        - 帳票作成フォームの各入力欄を特定するためのCSSセレクタやXPathは、どの程度安定しているか。`id`属性のような堅牢なセレクタが存在するか、あるいは`class`名の動的な変更など、不安定な要素はないかを調査する。
    4.  **エラーハンドリングの試作:**
        - 意図的に間違ったセレクタを指定するなどして、RPAが失敗した場合の例外を捕捉し、エラーログを記録する仕組みを試作する。

#### **PoC-2: AI/LLM活用機能の品質・コスト評価**

- **対象機能:** `REP-002` (AIコメントアシスト), `OB-001` (Ordinance Bot)
- **実施期間:** 3週間（プロンプト最適化に時間を要するため）
- **目的:** LLM（大規模言語モデル）を利用した機能が、ビジネス要件を満たす品質（精度・内容）と、許容可能なコスト・速度で実現できるかを見極める。
- **検証項目:**
    1.  **プロンプトエンジニアリング:**
        - `REP-002`: 実際の物件データ数件を基に、「強み」「弱み」「周辺環境」などを考慮した所見コメントを生成させるための最適なプロンプトテンプレートを探る。複数のLLM（GPT-4o, gemini 2.5 Pro, Claude 4 Sonnet ）で出力品質を比較する。
        - `OB-001`: 物件住所から関連法規を検索させるプロンプトを試作し、どの程度正確な結果が得られるか、また、事実に基づかない情報（ハルシネーション）をどの程度生成してしまうかを確認する。
    2.  **コストと速度の計測:**
        - 上記のプロンプトで、リクエストあたりの平均トークン消費量と、レスポンスタイムを計測する。これが、仕様書で定めた利用制限（トークン数、APIコール回数）の妥当性を評価する根拠となる。
    3.  **PII（個人情報）マスキング:**
        - LLMへの入力データ（プロンプト）に含まれる物件住所などの個人情報を、ログ保存前に機械的にマスキングする処理を試作し、その有効性を確認する。

#### **PoC-3: 外部APIの接続性・仕様確認**

- **対象機能:** `CON-001` (アットホーム連携), `LCP-001` (e-Gov法令API連携)
- **実施期間:** 2週間（APIの仕様確認は比較的短期で可能）
- **目的:** サードパーティAPIの利用規約、認証方式、レートリミット、レスポンス仕様などを実際に通信して確認し、机上の想定との乖離がないかを検証する。
- **検証項目:**
    1.  **認証と接続:**
        - 開発者アカウントやAPIキーを申請・取得し、各APIのエンドポイントに対して基本的なリクエスト（疎通確認）が成功するか試す。
    2.  **サンドボックス環境の有無:**
        - 本番データに影響を与えずに開発・テストが可能なサンドボックス（テスト環境）が提供されているか確認する。提供されていない場合、テスト戦略をどう工夫すべきか検討する。
    3.  **レートリミットの検証:**
        - 短時間に意図的に多数のリクエストを送信し、仕様書通りのレートリミット（例: 30コール/分）でエラーレスポンスが返ってくるか、またその際のエラーメッセージの内容を確認する。

#### **PoC-4: スキーマ分離マルチテナントの実現性検証**

- **対象機能:** システム全体のデータベースアーキテクチャ
- **実施期間:** 3週間（アーキテクチャ設計とマイグレーション検証が必要）
- **目的:** 採用を決定した「スキーマ分離（Schema-per-tenant）」方式が、利用予定の技術スタック（ORM、マイグレーションツール等）でスムーズに実装・運用できるかを確認する。
- **検証項目:**
    1.  **動的スキーマ切り替え:**
        - ログインユーザーのテナントIDに基づき、リクエストごとにデータベース接続の`SEARCH_PATH`を動的に切り替えるミドルウェア（またはデコレータ）を試作する。
    2.  **データベースマイグレーション:**
        - 新しいテーブル追加やカラム変更といったマイグレーションスクリプトを、単一コマンドで「全ての既存テナントスキーマ」に対して一斉に適用できるか検証する。
    3.  **クロススキーマクエリ:**
        - システム管理者が、複数のテナントスキーマを横断してデータを集計するようなクエリ（例: 全テナントの総案件数）を、どの程度効率的に実行できるか調査する。

---

### 3. 成功基準（Exit Criteria）

各PoCの実装判断を行うための定量的な成功基準を以下に定義する。すべての基準を満たした場合のみ「実装可能」と判定する。

#### **PoC-1: RPA連携の安定性検証**

| 検証項目 | 成功基準 | 失敗時の対応 | 事業インパクト評価 |
| :--- | :--- | :--- | :--- |
| ログインプロセス | 自動ログイン成功率 **95%以上**（100回試行中） | 手動操作フローバックに変更 | **中程度** - 業務効率低下、人的コスト増 |
| **CAPTCHA/MFA検証** | CAPTCHA未発生率 **100%**（50回ログイン試行中） | **重大** - RPA機能完全除外、事業モデル根本見直し | **極めて高** - 主要価値提案の消失、競合優位性喪失、ユーザビリティ大幅悪化 |
| セレクタ堅牢性 | 主要セレクタ安定性 **90%以上**（10日間連続監視） | セレクタ自動修復機能の開発追加 | **中程度** - 開発工数増、保守負荷増 |
| エラーハンドリング | 例外捕捉率 **100%**（意図的エラー20回中） | エラー処理ロジックの見直し | **低** - 開発品質の問題 |

**事業継続性リスク分析:**
- **CAPTCHA導入の場合:** 契約書自動生成機能(CTR-001)が完全停止。代替として手動CSV生成のみとなり、「三重入力解消」という主要価値提案が破綻。月額3万円の価格正当性が失われ、事業計画の根本的見直しが必要。
- **緊急対応計画:** CAPTCHA検知時は48時間以内にフェイルセーフモード（完全手動操作）への自動切替を実装。同時に、ハトサポ以外の代替手段（内製テンプレートエンジンの前倒し開発）を6ヶ月以内に完成させる。

#### **PoC-2: AI/LLM活用機能の品質・コスト評価**

| 検証項目 | 成功基準 | 失敗時の対応 |
| :--- | :--- | :--- |
| 出力品質（REP-002） | 人間評価者による品質評価 **4.0点以上**（5点満点、20サンプル評価） | プロンプト改良またはLLMモデル変更 |
| 出力精度（OB-001） | 法令検索結果の正確性 **85%以上**（50ケース検証） | 検索精度向上またはハルシネーション対策追加 |
| レスポンス時間 | 平均レスポンス時間 **3秒以内**（100リクエスト計測） | キャッシュ機能追加またはモデル変更 |
| コスト効率 | 1リクエストあたりコスト **10円以下**（トークン単価ベース） | 使用量制限強化またはモデル変更 |

#### **PoC-3: 外部APIの接続性・仕様確認**

| 検証項目 | 成功基準 | 失敗時の対応 |
| :--- | :--- | :--- |
| API疎通確認 | 全対象API疎通成功率 **100%**（各API 10回試行） | 該当API連携機能の除外 |
| レートリミット | 仕様通りのレート制限検証 **完全一致**（各API境界値テスト） | リクエスト制御ロジックの調整 |
| エラーハンドリング | 想定外エラーの適切な処理 **100%**（異常系20パターン） | エラー対応フローの見直し |
| データ形式整合性 | APIレスポンス形式の仕様適合 **100%**（各API 50件取得） | データ変換ロジックの追加 |

#### **PoC-4: スキーマ分離マルチテナントの実現性検証**

| 検証項目 | 成功基準 | 失敗時の対応 |
| :--- | :--- | :--- |
| 動的スキーマ切り替え | 切り替え成功率 **100%**（1000回切り替え試行） | アーキテクチャの根本的見直し |
| マイグレーション実行 | 全スキーマ一斉適用成功率 **100%**（10スキーマ×5回実行） | マイグレーション戦略の変更 |
| パフォーマンス | クロススキーマクエリ実行時間 **5秒以内**（10スキーマ集計） | インデックス最適化またはクエリ改良 |
| データ分離検証 | テナント間データ漏洩 **0件**（100回ランダムアクセステスト） | 分離方式の根本的見直し |

---

### 4. 複合リスク分析

複数のPoCが同時に失敗した場合の事業への複合的な影響を分析する。

#### **最悪シナリオ分析：複数PoC同時失敗**

| 失敗組み合わせ | 事業インパクト | 対応期間 | 必要追加投資 | 事業継続可能性 |
|--------------|---------------|---------|-------------|----------------|
| **PoC-1(RPA) + PoC-2(AI)** | **極めて高** | 12-18ヶ月 | 5,000万円 | **要事業計画見直し** |
| **PoC-1(RPA) + PoC-4(MT)** | **高** | 8-12ヶ月 | 3,000万円 | 機能削減して継続可能 |
| **PoC-2(AI) + PoC-3(API)** | **中** | 6-9ヶ月 | 1,500万円 | 継続可能（競合劣位） |
| **3つ以上同時失敗** | **事業破綻** | 18ヶ月+ | 1億円+ | **事業中止検討** |

#### **リスク軽減戦略**

1. **段階的実施による早期リスク発見**
   - PoC-1（RPA）を最優先で実施
   - CAPTCHA検知時点で即座に事業計画見直しを開始

2. **代替案の事前準備**
   - RPA失敗時：内製テンプレートエンジンの設計完了
   - AI失敗時：ルールベース処理への代替ロジック準備
   - API失敗時：手動データ連携フローの詳細設計

3. **投資家・ステークホルダーへの早期報告**
   - 各PoC完了時点で結果を即座に共有
   - 失敗時の代替計画と追加投資必要額を明示 