### **アーキテクチャ方針 v1.1**

**文書ID:** `ARC-004`
**文書名:** `多言語対応方針 (i18n)`

| Ver | 日付 | 作成 / 変更者 | 変更概要 |
|-----|------|---------------|----------|
| 1.0 | 2025-06-30 | システム管理者 | 初版作成 |
| 1.1 | 2025-06-30 | システム管理者 | バージョン管理追加、I18nライブラリ選定理由詳細化 |

---

### 1. はじめに

**【重要】海外展開の方針について:**
海外の顧客や投資家との不動産取引（インバウンド取引）での利用は**検討段階にあり、実施の確度は未確定**である。しかし、多言語対応（i18n: Internationalization）は後から追加すると多大なコストと時間がかかるため、最小限の準備を先行して行う方針とする。

**対応レベル:**
- **Phase 1（現在）:** 多言語化の技術的基盤のみ構築（国内向け機能開発を阻害しない範囲）
- **Phase 2（海外展開決定時）:** 実際の翻訳作業・地域対応機能の本格実装

本ドキュメントは、上記のPhase 1における多言語対応の最小限の準備方針を定めるものである。海外展開が正式に決定された場合の拡張性を確保しつつ、当面は国内市場に集中できる実装方針を採る。

### 2. 基本方針

多言語対応は、「UI/システムメッセージ」と「ユーザーコンテンツ」の2種類に大別して考える。

#### 2.1. UI/システムメッセージ (翻訳対象)

- **定義:** ボタンのラベル、メニュー項目、エラーメッセージ、説明文など、アプリケーションが提供する固定のテキスト情報。
- **方針:**
  - **リソースファイルによる外部管理:** 全てのUIテキストは、ソースコード内に直接記述（ハードコーディング）せず、言語ごとのリソースファイル（例: `ja.json`, `en.json`）でキーと値のペアとして一元管理する。
    ```json
    // 例: ja.json
    {
      "dashboard.title": "案件ダッシュボード",
      "button.save": "保存"
    }
    ```
  - **ライブラリの活用:** フロントエンドでは`react-i18next`を採用し、リソースファイルの読み込みとテキストの置換を効率的に行う。
  - **レイアウトの考慮:** ドイツ語のように、日本語や英語に比べて単語が長くなる言語でもレイアウトが崩れないよう、UIコンポーネントはテキストの長さに柔軟に対応できる設計（例: `width`を固定しない）を心がける。

#### 2.3. I18nライブラリ選定理由

React/Next.jsベースのアプリケーションにおける主要なi18nライブラリを比較検討し、`react-i18next`を採用する。

| ライブラリ | メリット | デメリット | 採用判定 |
| :--- | :--- | :--- | :--- |
| **react-i18next** | ・最も成熟した実績あり（GitHub 8.8k stars）<br>・SSR/SSG対応<br>・豊富なプラグイン・拡張機能<br>・複数の読み込み戦略（lazy loading等）<br>・TypeScript完全対応 | ・設定がやや複雑<br>・初期学習コストが高い | ✅ **採用** |
| **next-intl** | ・Next.js専用設計でシンプル<br>・App Router完全対応<br>・型安全性が高い<br>・設定が簡潔 | ・比較的新しく実績が少ない<br>・Next.js以外では使用不可<br>・機能が限定的 | ❌ 非採用 |
| **react-intl (FormatJS)** | ・Facebook（Meta）開発<br>・ICU Message Formatサポート<br>・数値・日付フォーマット充実 | ・学習コストが高い<br>・設定が複雑<br>・比較的重い | ❌ 非採用 |

**採用理由:**
- **実績と信頼性:** 長期間の開発・保守実績があり、エンタープライズレベルでの安定稼働が期待できる
- **将来の拡張性:** 複雑な翻訳要件（文脈による翻訳、複数形対応等）への対応力が高い
- **技術的柔軟性:** React以外のフレームワークへの移行時にも知見を活用できる

#### 2.2. ユーザーコンテンツ (翻訳対象外)

- **定義:** ユーザーが自由に入力するデータ。物件の紹介コメント、顧客の氏名・住所、チャットのメッセージなど。
- **方針:**
  - **原則として翻訳しない:** ユーザーが入力したデータは、いかなる言語であっても、入力された内容のままデータベースに保存し、そのまま表示する。システムによる自動翻訳は、誤訳のリスクやコストを考慮し、原則として行わない。
  - **文字コード:** データベースおよびアプリケーション全体で、文字コードは`UTF-8`を標準とし、世界の主要な言語を欠損なく扱えるようにする。

### 3. 地域依存データの扱い (L10n: Localization)

言語だけでなく、地域によって異なる数値のフォーマット（日付、通貨、単位）にも対応する。

- **日付・時刻:** `2025/06/30` (日本) vs `06/30/2025` (米国) のような違いに対応するため、データは常にタイムゾーン付きの標準形式（`ISO 8601`形式の文字列 or `Unixタイムスタンプ`）で保存・API交換する。表示のフォーマットは、フロントエンド側でユーザーのロケール設定に応じて行う。
- **通貨:** 金額を扱う際は、単一の数値型だけでなく、通貨コード（例: `JPY`, `USD`）もセットで保持できるデータ構造を検討する。
  ```json
  // 例: 金額のデータ構造
  {
    "amount": 35000000,
    "currency": "JPY"
  }
  ```
- **単位:** 物件の面積など、単位が複数存在しうる項目（例: `m²`, `坪`）についても、値と単位をセットで管理する。
  ```json
  // 例: 面積のデータ構造
  {
    "value": 70.5,
    "unit": "m^2"
  }
  ```

### 4. 表示ロケールの決定ロジック

ユーザーに表示する言語と地域フォーマット（ロケール）は、以下の優先順位で決定する。

1.  **ユーザーのプロファイル設定:** ユーザーがアカウント設定画面で明示的に言語（例：「日本語」「English」）を選択している場合、その設定を最優先とする。
2.  **ブラウザの言語設定:** ユーザーがプロファイルで言語を設定していない場合、ブラウザが送信する`Accept-Language` HTTPヘッダーの値からロケールを推定する。
3.  **システムのデフォルト設定:** 上記のいずれでもロケールを特定できない場合、システムのデフォルト言語である`日本語 (ja-JP)`を適用する。

この方針に従うことで、将来的な多言語展開をスムーズに進めるための技術的基盤を構築する。 