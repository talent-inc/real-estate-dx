# 監査ログポリシー

| Ver | 日付 | 作成 / 変更者 | 変更概要 |
|-----|------|---------------|----------|
| 1.0 | 2025-06-30 | システム管理者 | 初版作成 |
| 1.1 | 2025-06-30 | システム管理者 | バージョン管理追加、保存戦略とコスト見積もり詳細化 |

本ドキュメントは、システムで生成される監査ログの取り扱いに関する方針を定める。

## 1. 目的

- **セキュリティインシデントの追跡:** 不正アクセスや情報漏洩などのインシデント発生時に、原因調査と影響範囲の特定を可能にする。
- **コンプライアンス要件の遵守:** 法規制や業界基準で求められるログの記録・保管要件を満たす。
- **システム利用状況の可視化:** 誰が、いつ、どのリソースにアクセスし、何を行ったかを記録することで、システムの利用状況を把握し、不正利用を抑止する。

## 2. ログ収集の対象

以下の操作を監査ログの収集対象とする。

- **認証イベント:**
  - ログイン成功・失敗
  - ログアウト
  - パスワード変更・リセット
- **アクセス制御イベント:**
  - ユーザー・ロールの作成、変更、削除
  - 権限設定の変更
- **データ操作イベント:**
  - 主要なリソース（物件情報、顧客情報、契約情報など）の作成、読み取り、更新、削除 (CRUD)
- **システムイベント:**
  - 管理者によるシステム設定の変更
  - 外部システム連携の実行・失敗

## 3. ログのフォーマットと内容

- ログは、検索と分析が容易な**構造化された形式（JSON）**で記録する。
- 全てのログエントリには、最低でも以下の情報を含めること。
  - **タイムスタンプ (Timestamp):** イベント発生日時 (UTC)
  - **イベントソース (Event Source):** イベントが発生したサービスやコンポーネント名
  - **イベント名 (Event Name):** イベントの種類（例: `user.login.success`）
  - **アクター (Actor):** 操作を実行したユーザーのIDやシステムのプロセス名
  - **リソース (Resource):** 操作対象のリソースID（例: `property_id`）
  - **IPアドレス (IP Address):** リクエスト元のIPアドレス
  - **ユーザーエージェント (User Agent):** リクエスト元のクライアント情報

## 4. ログの保管とアーカイブ

### 4.1. ストレージ戦略とコスト

| フェーズ | ストレージ | 保持期間 | アクセス性 | 想定コスト（月額/GB）* |
| :--- | :--- | :--- | :--- | :--- |
| **ホットストレージ** | - Google Cloud Logging<br>- Cloud Logging Analytics | **90日間** | - 高速な検索・分析が可能<br>- システム管理者、開発者がアクセス | $0.50/GB |
| **ウォームストレージ** | - Cloud Storage Standard | **91日目〜1年** | - やや低速な検索<br>- 主にセキュリティ監査担当者が利用 | $0.020/GB |
| **コールドストレージ（アーカイブ）** | - Cloud Storage Archive | **1年後〜5年** | - 検索には数時間の復元時間が必要<br>- 法的要請など、特別な場合に限りアクセス | $0.0012/GB |

*コスト試算は2025年6月時点のGoogle Cloud東京リージョン料金を基準。取得・転送コストは別途。

### 4.2. ログ容量とコスト見積もり

- **想定ログ生成量:** 1日あたり5GB（ユーザー1,000名、API呼び出し100万回/日を想定）
- **年間総容量:** 約1.8TB
- **5年間総保管コスト試算:**
  - ホットストレージ（90日分）: 450GB × $0.50 = $225/月
  - ウォームストレージ（275日分）: 1.375TB × $0.023 = $32/月
  - コールドストレージ（4年分）: 7.2TB × $0.00099 = $7/月
  - **合計:** 約$264/月（年間$3,168）

### 4.3. 運用方針

- **保持期間:** 全ての監査ログは、最低**5年間**保管するものとする。
- **自動化:** ログはライフサイクルポリシーに基づき、ホット → ウォーム → コールドストレージへ自動的に移行される。
- **地理的分散:** 災害対策として、メインリージョン（東京）とバックアップリージョン（大阪）の両方に保管する。
- **暗号化:** 保管時および転送時の暗号化（AES-256）を必須とする。

## 5. ログの検索・監視

- **検索要件:**
  - **システム管理者 (super_admin):** 全ての監査ログに対して、任意のキー（ユーザーID, IPアドレス, イベント名など）での検索・閲覧が可能。
  - **テナント管理者 (tenant_admin):** 自身が管理するテナント内のログに限り、検索・閲覧が可能。
- **監視とアラート:**
  - 特定の不審なイベント（例: 同一アカウントでの短時間での大量ログイン失敗）を検知した場合、リアルタイムでセキュリティチームにアラートを通知する仕組みを構築する。 