# システム仕様書 v2.0

**文書ID:** `SYS-001`
**文書名:** `不動産売買仲介業務支援プラットフォーム システム仕様書`

| Ver | 日付 | 作成 / 変更者 | 変更概要 |
|-----|------|---------------|----------|
| 1.0 | 2025-06-01 | システム管理者 | 初版作成 |
| 1.1 | 2025-06-10 | システム管理者 | 技術スタック詳細化 |
| 1.2 | 2025-06-15 | システム管理者 | 外部連携方針追加 |
| 1.3 | 2025-06-20 | システム管理者 | 非機能要件詳細化 |
| 1.4 | 2025-06-25 | システム管理者 | 運用・保守要件追加 |
| 2.0 | 2025-06-30 | システム管理者 | マークダウン記法修正、機能要件大幅充実化、管理系機能追加 |

---

## Part 1: システム概要とアーキテクチャ

### 1. 本書について

**1.1. 目的** 
本文書は、不動産売買仲介業務支援プラットフォーム（以下、本システム）の全体像、目的、機能範囲、技術的構成、および非機能要件を定義することを目的とします。これは、プロジェクト関係者全員が、構築すべきシステムについて一貫した理解を持つための基盤となります。

**1.2. 対象読者** 
プロジェクトマネージャー、システムアーキテクト、開発エンジニア、品質保証（QA）担当者、および事業責任者。

**1.3. 用語定義**

- **モノリス+ワーカーアーキテクチャ (Monolith + Worker Architecture)**
  - 本システムのMVP/β版で採用する、開発速度と性能を両立させるための現実的な設計手法です。
    - **モノリス:** お客様が直接操作する中心機能（画面表示、データ入力など）を、一つの大きなアプリケーションとして迅速に開発します。
    - **ワーカー:** 登記簿PDFのAI解析や、ハトサポへの自動登録といった、時間のかかる重い処理を、バックグラウンドで専門に実行する独立したプログラムです。
- **マイクロサービスアーキテクチャ (Microservices Architecture)**
  - 将来的に本システムが目指す、より高度な設計手法です。システムの機能を、それぞれが独立して動作する小さなサービスの集合体として構築します。
- **SaaS (Software as a Service)**
  - インターネット経由でサービスとして提供・利用する形態です。ユーザーはWebブラウザからアクセスするだけで常に最新の機能を利用できます。
- **API (Application Programming Interface)**
  - 異なるソフトウェア同士が、決められたルールに従って情報をやり取りするための「通用口」です。
- **RPA (Robotic Process Automation)**
  - APIが提供されていないシステムと連携するため、「ソフトウェアのロボット」が人間に代わって画面操作を自動で行う技術です。
- **CI/CD (継続的インテグレーション/継続的デリバリー)**
  - ソフトウェア開発を自動化する仕組みを、本システムでは法務・コンプライアンス領域に応用し、法改正への迅速かつ確実な対応を実現します。

### 2. システム概要

**2.1. システムの目的と背景**

本システムは、中堅不動産売買事業者が直面している、深刻なバックオフィス業務の非効率性を根本から解決することを目的とします。具体的には、『売買革命』『ハトサポBB』『レインズ』といった複数の独立したシステム間で発生している、**1案件あたり1時間以上を要する「三重入力」の課題を撲滅します**。

同時に、現場が最も重視する「顧客に不利益を与えない」ための**法的信頼性を、協会システムに依存することなく、より高いレベルで実現**します。

**2.2. システムの提供形態**

100%クラウドベースのSaaS（Software as a Service）として提供します。ユーザーはWebブラウザからアクセスし、場所を問わず利用可能です。

**2.3. ターゲットユーザー**

主要ターゲットは、従業員10〜50名規模の中堅不動産会社です。複数のシステムを併用しており、特に契約書作成時の二重入力や、不慣れな地域の法令調査に課題を感じている事業者を対象とします。

### 3. システムアーキテクチャ

**3.1. ハイレベル構成**

本システムは、事業フェーズに応じてアーキテクチャを進化させ、開発速度と将来の拡張性を両立させます。

**3.1.1. 短期アーキテクチャ方針（MVP/β版）**
- **方針:** 「モノリス+ワーカー」アーキテクチャを採用します。
- **目的:** 開発速度を最大化し、現場の最大のペインポイントである「三重入力」を最速で解消することを最優先とします。
- **役割:** この段階では、本システムは「ハブ／パイプ役」として機能します。

**3.1.2. 中長期アーキテクチャ方針（本格展開後）**
- **方針:** 「マイクロサービス」アーキテクチャへ段階的に移行します。
- **目的:** スケーラビリティ、可用性の向上、および機能ごとの独立した開発・デプロイを可能にすることで、大規模な顧客基盤を支える強固なプラットフォームを構築します。

**3.2. 主要技術スタック**

**【Claude Code + shadcn/ui 対応により確定済み】**

- **フロントエンド:**
  - **Framework:** Next.js 14 (App Router) + React.js
  - **言語:** TypeScript
  - **UI Library:** shadcn/ui + Tailwind CSS
  - **状態管理:** Zustand
  - **Icons:** Lucide React
- **バックエンド:**
  - **メインAPI:** Node.js + TypeScript + Fastify
  - **AI処理ワーカー:** Python + FastAPI
  - **API設計:** tRPC (メイン) + REST API (外部連携)
  - **ORM:** Prisma
- **データベース:** PostgreSQL 15+ (with PostGIS for 地図情報)
- **インフラ・デプロイ:**
  - **フロントエンド:** Vercel
  - **API・ワーカー:** Google Cloud Run
  - **将来拡張:** Kubernetes対応検討
- **AI関連:** **Gemini 2.0 Flash**（OCR最適化）, **Gemini 2.5 Flash**（汎用タスク）
  - **検証候補:** Google Document AI (for Japanese) - Gemini OCRの精度を補完するためのバックアップとして検証。
- **開発ツール:**
  - **Monorepo:** Turborepo
  - **Package Manager:** pnpm
  - **Linting:** ESLint + TypeScript ESLint
  - **Formatting:** Prettier
- **CI/CD (法令/システム):** Git (GitOps), GitHub Actions, Playwright

**【選定根拠】** 

shadcn/ui + Claude Code によるAI駆動開発を前提とし、UI簡易化と開発効率最大化を図る。詳細は `docs/architecture/技術選定根拠書.md` を参照。

**3.3. 外部システム連携**

本システムの価値を最大化するため、以下の外部システムと連携します。

- **ハトサポBB:**
  - **連携方法:** 現状、公開APIが存在しないため、RPA技術（Playwright等）を用いて、本システムのバックグラウンドでブラウザ操作を自動化します。
  - **信頼性担保:** RPAプロセスは毎晩定時にE2E（End-to-End）ヘルスチェックを実行。失敗検知時には、ユーザーが手動でCSVをダウンロードできるフェイルセーフUIへ自動で切り替わります。
- **レインズ (REINS):**
  - **連携方法:** 直接的なAPI連携は不可。競合の営業議事録でも言及された通り、アットホーム社などが提供する連携APIを介するルート、またはレインズ指定のCSVフォーマットを自動生成するルートで登録を実現します。
- **不動産ポータルサイト (SUUMO, at home等):**
  - **連携方法:** 公開APIが提供されている場合はAPI連携、ない場合はRPAで対応します。
- **法務・行政情報:**
  - **連携方法:** e-Gov法令APIなどを定期的にポーリングし、法改正情報を取得します。

---

## Part 2: システム要件（機能・非機能）

### 4. 機能要件

本システムの機能は、事業フェーズに応じて段階的に実装・拡張されます。各機能要件において、**【短期】**はMVP/β版で実現する範囲を、**【中長期】**は本格展開後に目指す範囲を示します。

**4.1. 案件管理**

**4.1.1. 案件ダッシュボード（DSH-001）**
- **【短期】** 担当する全案件の進捗状況、次のアクション、期日などを一覧で可視化できる。
  - KPI表示（案件進捗率、成約率、平均案件期間等）
  - 進捗ステータス管理（商談中、契約準備中、決済完了等）
  - 期日超過アラート機能
- **【中長期】** AIベースの案件分析機能を追加
  - 成約予測アルゴリズム（過去データ基準）
  - 案件ボトルネック分析とアクション提案
  - 地域別・物件種別の市場トレンド分析
  - チーム全体のパフォーマンス分析ダッシュボード

**4.2. 査定・媒介契約**

**4.2.1. 登記情報AI-OCR（OCR-001）**
- **【短期】**
  -  **機能:** 登記簿謄本等のPDFファイルをアップロードすると、AIが物件情報を自動抽出し、物件マスタへ登録する。
  - **対象範囲と制約:** 初期バージョンでは、直近10年以内に発行されたデジタル形式の謄本を主対象とする。著しく低解像度のFAXスキャンや、複雑な手書き備考欄は対象外とする。対象外と判定された項目はUI上でグレーアウト表示し、手動入力を促すことでユーザーの期待値を管理する。
  - **AI処理:** OpenAI GPT-4o Vision + AWS Textract
- **【中長期】** 
  - **対象範囲拡大:** 古い手書き謄本、建物図面、地積測量図への対応
  - **精度向上:** Google Document AI（日本語特化）の併用によるダブルチェック
  - **データ連携:** 法務局との直接API連携検討（将来的なDX化対応）
  - **バッチ処理:** 大量ファイルの一括処理機能

**4.2.2. AIコメントアシスト**
- **【短期】** AI-OCR情報やユーザー入力情報に基づき、査定書に記載すべき推奨コメントを複数提示する。
- **【中長期】**
  - **学習機能:** 過去の成約事例から最適な査定コメントを学習
  - **地域特性:** エリア別の市場動向を反映したコメント生成
  - **比較査定:** 類似物件との比較データを自動生成

**4.2.3. 査定書生成（REP-002）**
- **【短期】** 基本的な査定書テンプレートからの自動生成
- **【中長期】**
  - **カスタマイズ機能:** 会社ごとの査定書フォーマット対応
  - **根拠データ:** 近隣事例、公示価格、路線価の自動取得・反映
  - **AI査定:** 機械学習による査定額の妥当性チェック

**4.3. 販売活動**

**4.3.1. Unified Form（UF-001）**
- **【短期】** 本システムの中核。一度このフォームに物件情報を入力すれば、後続の全てのプロセスにデータが同期される。
  - **統一データモデル:** 全外部システム対応の共通物件データスキーマ
  - **リアルタイム同期:** 入力即座に各システムへデータ反映
  - **バリデーション:** 各システムの必須項目チェック機能
- **【中長期】**
  - **AIアシスト入力:** 過去データから物件特徴を推測・提案
  - **音声入力:** 現地調査時の音声メモからの自動入力
  - **画像解析:** 物件写真からの間取り・設備情報自動抽出
  - **マスターデータ管理:** 物件情報の変更履歴・バージョン管理

**4.3.2. 物件概要書（募集資料）作成（REP-001）**
- **【短期】** Unified Formの情報から、表示項目をカスタマイズ可能なデザイン性の高い物件概要書を生成できる。ハトサポの固定的なフォーマットでは対応できないニーズを満たす。
  - **テンプレート機能:** 複数デザインから選択可能
  - **カスタマイズ:** ロゴ、色調、レイアウトの調整
  - **多形式出力:** PDF、Word、PowerPoint対応
- **【中長期】**
  - **AIデザイン:** 物件特性に最適なレイアウト自動提案
  - **動的コンテンツ:** 市場価格、周辺施設情報の自動取得・反映
  - **多言語対応:** 外国人向け資料の自動翻訳生成
  - **VR/3D:** バーチャル内見機能との連携

**4.3.3. ポータル・レインズ一括登録**
- **【短期】** Unified Formの情報を基に、主要不動産ポータルサイトおよびレインズへワンクリックで情報登録・更新を行う。

**4.3.4. レインズ連携（CON-001）**
- **【短期】** アットホーム経由でのレインズ自動登録・更新
- **【中長期】** レインズ公式API対応（将来的なAPI公開時）

**4.3.5. 不動産ポータルサイト連携（CON-002）**
- **【短期】** SUUMO、at home等への基本的な物件情報連携
- **【中長期】** 
  - **全ポータル対応:** 楽待、健美家等の収益物件特化サイト対応
  - **自動最適化:** ポータル別の反響率を分析し掲載内容を最適化
  - **効果測定:** ポータル別の集客効果・ROI分析

**4.4. 契約・決済**

**4.4.1. Ordinance Bot（法令・条例リサーチ）（OB-001）**
- **【短期】** 物件住所に基づき、都市計画法、建築基準法、および地方自治体独自の条例（景観条例、建築協定等）をAIが自動調査し、重要事項説明書の該当項目に反映させる。
  - **対象法令:** 建築基準法、都市計画法、消防法、宅建業法
  - **自治体条例:** 景観条例、建築協定、地区計画等
  - **データソース:** e-Gov法令API、自治体公開情報
- **【中長期】**
  - **AIリーガルチェック:** 法令違反リスクの自動判定
  - **判例データベース:** 過去の類似事例・判例の自動検索
  - **専門家連携:** 複雑事案の士業への自動エスカレーション
  - **更新通知:** 関連法改正の自動通知機能

**4.4.2. 重要事項説明書・売買契約書作成（CTR-001）**
- **【短期】（連携・自動操作モデル）**
  - 法令CI/CDパイプライン（LCP-001）により、常に最新の法改正が反映されたテンプレートの「構成情報」を管理。
  - ユーザーが帳票生成を指示すると、裏側でRPAがハトサポBBを自動操作し、協会ロゴ付きの最新書式としてPDFを生成・取得する。
  - **利用率計測:** ハトサポBB連携機能の利用率を計測するメトリクス（例：帳票生成総数に対するRPA実行数の割合）を実装する。このメトリクスは、将来的な機能廃止のデータドリブンな意思決定に用いる。（目標：12ヶ月後に利用率10%未満）
- **【中長期】（内製化・代替モデル）**
  - RPAによる外部依存をなくし、本システム内に高機能な契約書エディタを実装。法令CI/CDパイプラインと直接連携し、システム内で完全に帳票生成を完結させる。
  - **テスト:** 帳票生成テストの網羅性は、附録として定義・管理する「帳票差分テストケース・マトリクス」（例：共有名義人×土地建物分離×特約の組み合わせ）に基づき担保する。
  - **高度エディタ:** 条文の自動提案・挿入機能
  - **差分管理:** 契約書バージョン管理・比較機能

**4.4.3. 法令CI/CDパイプライン（LCP-001）**
- **【短期】** 法改正の自動検知・テンプレート更新システム
- **【中長期】** 
  - **影響度分析:** 法改正が各契約書テンプレートに与える影響度の自動判定
  - **自動テスト:** 改正後テンプレートの整合性自動検証
  - **段階展開:** 改正内容の段階的適用（開発→テスト→本番）

**4.4.4. オンデマンド士業連携**
- **【短期】** AIが「法的解釈に注意を要する」と判断した特約事項などに対し、フラグを立て、提携司法書士にレビュー依頼を自動通知する。
- **【中長期】**
  - **専門分野別連携:** 税理士、土地家屋調査士等の専門分野別自動振り分け
  - **オンライン相談:** ビデオ会議による即座の専門家相談
  - **ナレッジベース:** 過去の相談事例・回答のデータベース化

**4.5. 顧客管理・営業支援**

**4.5.1. 顧客データベース**
- **【短期】** 物件取引に関わる売主・買主の基本情報を管理できる。
  - **基本情報管理:** 個人・法人情報、連絡先、取引履歴
  - **プライバシー保護:** 個人情報の暗号化・アクセス制限
- **【中長期】**
  - **顧客セグメント:** 購入意欲度・購入力による自動分類
  - **行動分析:** サイト訪問・資料請求等の行動履歴分析
  - **重複排除:** 同一顧客の重複登録自動検知・統合

**4.5.2. 軽量CRM機能（CRM-001）**
- **【短期】** 基本的な追客機能・コミュニケーション履歴管理
  - **案件別管理:** 顧客と案件の紐付け管理
  - **タスク管理:** フォローアップ予定・実績管理
  - **コミュニケーション履歴:** 電話・メール・面談記録
- **【中長期】** 
  - **自動追客:** AIによる最適なタイミング・内容での自動フォローアップ
  - **成約予測:** 顧客行動パターンから成約確率を算出
  - **マーケティング自動化:** セグメント別のメール配信・資料送付
  - **売上予測:** パイプライン分析による売上予測

**4.6. データ移行・基盤機能**

**4.6.1. データ移行ウィザード（MIG-001）**
- **【短期】** 初回導入時、既存システム（ハトサポBB、売買革命等）のCSVファイルを本システムへ一括でインポートできる機能。
  - **大容量対応:** 100MB超のCSVファイルのチャンク処理
  - **エラーハンドリング:** 不正データの検知・修正支援
  - **プレビュー機能:** インポート前のデータ確認
- **【中長期】**
  - **リアルタイム同期:** 既存システムとのリアルタイムデータ同期
  - **API連携:** 他社システムとのAPI経由データ連携
  - **自動マッピング:** AIによるデータ項目の自動対応付け

**4.7. システム管理・運用機能**

**4.7.1. テナント管理機能（TNT-001）**
- **【短期】** マルチテナント環境での会社別データ分離・権限管理
  - **データ分離:** 会社間の完全なデータ分離保証
  - **ユーザー管理:** 会社内での役割別権限設定
  - **初期設定:** 新規テナント作成・基本設定ウィザード
- **【中長期】**
  - **カスタマイズ:** テナント別UI・機能カスタマイズ
  - **統合管理:** グループ会社間でのデータ共有・統合分析
  - **自動プロビジョニング:** 新規テナントの自動環境構築

**4.7.2. サブスクリプション管理機能（SUB-001）**
- **【短期】** 基本的な課金・請求管理
  - **プラン管理:** 複数料金プランの設定・切り替え
  - **使用量監視:** 機能別使用量の計測・表示
  - **請求処理:** 月次請求書の自動生成・送付
- **【中長期】**
  - **動的課金:** 使用量に応じた従量課金システム
  - **予測課金:** AI使用量予測に基づく課金最適化
  - **セルフサービス:** 顧客による自動プラン変更機能

**4.7.3. システム管理機能（ADM-001）**
- **【短期】** 基本的なシステム設定・ユーザー管理
  - **ユーザー管理:** アカウント作成・削除・権限設定
  - **システム設定:** 各種パラメータ・設定値の管理
  - **ログ管理:** アクセスログ・操作ログの表示・検索
- **【中長期】**
  - **自動運用:** システムパフォーマンス監視・自動最適化
  - **セキュリティ管理:** 不正アクセス検知・自動ブロック
  - **コンプライアンス:** 法規制対応の自動チェック・レポート

**4.7.4. 使用量監視・制限機能（MON-001）**
- **【短期】** リソース使用量の監視・制限
  - **使用量表示:** CPU・メモリ・ストレージ使用量の可視化
  - **制限設定:** プラン別の使用量上限設定・強制停止
  - **アラート機能:** 使用量超過時の自動通知
- **【中長期】**
  - **予測監視:** 使用量トレンド分析・超過予測
  - **自動スケーリング:** 負荷に応じたリソース自動調整
  - **コスト最適化:** 使用パターン分析によるコスト削減提案

**4.7.5. サポート・問い合わせ管理機能（SUP-001）**
- **【短期】** 基本的なチケット管理システム
  - **問い合わせ受付:** Webフォーム・メール経由での問い合わせ受付
  - **チケット管理:** 問い合わせ内容の分類・優先度設定・対応状況管理
  - **FAQ機能:** よくある質問の管理・自動表示
- **【中長期】**
  - **AIチャットボット:** 基本的な問い合わせの自動回答
  - **音声サポート:** 音声認識による電話サポートの効率化
  - **予測サポート:** ユーザー行動から問題を予測・事前対応

**4.7.6. 外部連携用API機能（API-001）**
- **【短期】** 基本的なREST API提供
  - **物件データAPI:** 物件情報の取得・更新API
  - **認証API:** OAuth 2.0によるセキュアな認証
  - **レート制限:** API使用量制限・モニタリング
- **【中長期】**
  - **GraphQL対応:** 柔軟なデータ取得API
  - **Webhook:** リアルタイムデータ連携
  - **SDK提供:** 主要言語でのSDK・サンプルコード提供

### 5. 非機能要件

**5.1. 性能要件**

**5.1.1. レスポンスタイム**
- **通常画面操作:** 95%のケースで2秒以内に応答を返すこと
- **API応答時間:** 
  - 95th percentile: 500ms以内
  - 99th percentile: 2秒以内
- **大容量処理:**
  - OCR処理: 1ファイル（10MB以下）あたり30秒以内
  - CSV一括インポート: 1万件あたり5分以内

**5.1.2. スループット**
- **同時接続ユーザー数:** 500ユーザーまで対応
- **API処理能力:** 秒間1,000リクエストまで処理可能
- **ファイルアップロード:** 同時20ファイルまで並行処理

**5.1.3. 負荷想定・拡張性**

| フェーズ | 想定ユーザー数 | 想定会社数 | 同時接続数 | データ量 |
|----------|---------------|------------|------------|----------|
| α版 | 50ユーザー | 15社 | 10 | 1GB |
| β版 | 150ユーザー | 50社 | 30 | 10GB |
| 1年後 | 500ユーザー | 150社 | 100 | 50GB |
| 3年後 | 3,000ユーザー | 1,000社 | 500 | 500GB |

**5.2. 可用性・信頼性**

**5.2.1. サービス稼働率**
- **目標:** 年間稼働率99.9%以上（年間8.76時間以内のダウンタイム）
- **計測対象:** システム全体（UI・API・バッチ処理含む）
- **除外対象:** 計画メンテナンス（事前通知48時間以上）

**5.2.2. 災害復旧**
- **目標復旧時間（RTO）:** 4時間以内
- **目標復旧時点（RPO）:** 24時間以内（日次バックアップを保証）
- **バックアップ戦略:**
  - **データベース:** 日次フルバックアップ + リアルタイムレプリケーション
  - **ファイル:** 日次バックアップ、別リージョン保管
  - **設定情報:** Infrastructure as Code による自動復旧

**5.2.3. 冗長化**
- **アプリケーション:** 最低2台構成でのロードバランシング
- **データベース:** マスター・スレーブ構成
- **ファイルストレージ:** 3箇所での冗長保管

**5.3. セキュリティ要件**

**5.3.1. データ保護**
- **通信暗号化:** TLS 1.3以上（1.2以上互換性維持）
- **保管データ暗号化:** AES-256による全データ暗号化
- **暗号鍵管理:** AWS KMS等の専用サービスによる鍵管理
- **個人情報保護:** 不動産取引に関わる個人情報の厳格な管理

**5.3.2. アクセス制御・監査**
- **認証:** OAuth 2.0 + OpenID Connect
- **多要素認証:** SMS・メール・アプリ認証対応
- **アクセスログ監査:** 全ての重要操作ログを取得・保管
  - **保管期間:** 5年間（宅建業法対応）
  - **保管場所:** AWS S3 Glacier Deep Archive
- **監査対応:** SIEM による自動分析・異常検知

**5.3.3. 外部連携セキュリティ**
- **提携士業アクセス:** IPアドレス制限 + 時間限定トークン
- **API認証:** API Key + OAuth 2.0
- **RPA実行環境:** 専用VPC内での隔離実行

**5.3.4. データ保持・削除ポリシー**
- **契約中:** データ無制限保管（バックアップ含む）
- **契約終了後:** 法定保管期間（5年間）後の自動削除
- **個人情報削除:** 契約終了即座の仮名化処理
- **削除証明:** データ削除完了の証明書発行

**5.3.5. セキュリティ監査**
- **脆弱性診断:** 年2回の外部診断 + メジャーリリース前診断
- **ペネトレーションテスト:** 年1回の第三者による侵入テスト
- **セキュリティレビュー:** 機能追加時のセキュリティ設計レビュー

**5.4. 運用・保守性**

**5.4.1. 監視・メトリクス**
- **インフラ監視:** CPU・メモリ・ディスク・ネットワーク
- **アプリケーション監視:** エラー率・レスポンスタイム・処理件数
- **ビジネス監視:** 登録件数・成約率・利用状況
- **詳細:** `docs/architecture/api/metrics.md` 参照

**5.4.2. 運用体制**
- **監視体制:** 24時間365日の自動監視
- **障害対応:** 平日日中5分以内、夜間・休日30分以内の初期対応
- **エスカレーション:** 重要度別の対応フロー設定

**5.4.3. メンテナンス**
- **定期メンテナンス:** 月1回、日曜早朝実施（2時間以内）
- **緊急メンテナンス:** セキュリティ・重要バグ対応時の即座実施
- **アップデート:** 計画的なバージョンアップ（四半期1回）

**5.5. 拡張性・保守性**

**5.5.1. アーキテクチャ拡張性**
- **短期:** モノリス+ワーカー構成での垂直・水平スケーリング対応
- **中長期:** マイクロサービス化による独立スケーリング
- **データベース:** 読み込み専用レプリカによる負荷分散

**5.5.2. 開発・保守効率**
- **コード品質:** ESLint・Prettier による自動フォーマット
- **テスト:** 80%以上のコードカバレッジ維持
- **CI/CD:** 自動テスト・デプロイパイプライン
- **ドキュメント:** API仕様・設計書の自動生成・更新

**5.5.3. 多言語・多地域対応**
- **言語:** 日本語・英語対応（中国語・韓国語は将来検討）
- **タイムゾーン:** JST中心、将来的な他タイムゾーン対応準備
- **法令対応:** 日本の不動産関連法規への完全準拠
- **詳細:** `docs/architecture/多言語対応方針.md` 参照

---

## Part 3: 運用・保守、およびリスク管理

### 6. 運用・保守要件

**6.1. 監視体制**

システムの正常性を維持するため、以下の項目を常時監視し、閾値を超えた場合はアラートを発報する。

**6.1.1. インフラ監視**
1. **リソース使用率**
   - CPU: 80%以上で警告、90%以上で緊急
   - メモリ: 85%以上で警告、95%以上で緊急
   - ディスク: 80%以上で警告、90%以上で緊急
2. **ネットワーク監視**
   - レスポンスタイム、パケットロス率
   - 外部API接続状況

**6.1.2. アプリケーション監視**
1. **APIエラーレート:** 1%以上で警告、5%以上で緊急
2. **平均レスポンスタイム:** 2秒以上で警告、5秒以上で緊急
3. **非同期タスクキューの滞留数:** 100件以上で警告
4. **RPAプロセスの成功・失敗率:** 成功率90%以下で警告

**6.1.3. ビジネス監視**
1. **ユーザー活動:** 新規登録数、ログイン数の異常検知
2. **機能利用状況:** 各機能の利用率低下の検知
3. **データ品質:** OCR精度、API連携成功率の監視

**6.2. 運用体制と役割（R&R）**

障害発生時に迅速な対応を可能にするため、以下の役割分担を定義する。

| 時間帯 | 一次対応（On-call） | 二次対応（エスカレーション先） | 最終対応 |
|--------|---------------------|------------------------------|----------|
| **平日日中（9-18時）** | 開発チームA | 開発リード | CTO |
| **平日夜間（18-9時）** | 開発チームB | プロジェクトマネージャー | CTO |
| **休日・祝日** | チームA/Bローテーション | 開発リード | CTO |

**6.2.1. 役割詳細**
- **一次対応:** 初期対応・影響度評価・暫定対応
- **二次対応:** 根本原因分析・恒久対応・関係者連絡
- **最終対応:** 重要判断・メディア対応・経営報告

**6.3. 障害対応フロー**

**6.3.1. 検知・初期対応（0-5分）**
1. **自動検知:** 監視システムが異常を検知
2. **通知:** Slack・PagerDuty・SMS・電話による多段階通知
3. **応答:** On-call担当者が5分以内に応答（Acknowledge）

**6.3.2. 影響度評価・暫定対応（5-30分）**
1. **影響度判定:** ユーザー影響範囲・重要度の評価
2. **暫定対応:** ロードバランサ切り替え・機能停止等による影響最小化
3. **エスカレーション判断:** 30分以内に解決しない場合は二次対応へ

**6.3.3. 根本対応・復旧（30分-4時間）**
1. **根本分析:** ログ解析・システム調査による原因特定
2. **恒久対応:** システム修正・設定変更による根本的解決
3. **復旧確認:** 機能正常性・パフォーマンスの総合確認

**6.3.4. 事後対応（復旧後24-48時間）**
1. **インシデントレポート:** 原因・対応・再発防止策の文書化
2. **ポストモーテム:** 関係者での振り返り・プロセス改善
3. **再発防止:** システム改修・監視強化・手順見直し

### 7. 技術リスク管理

事業推進における主要な技術リスクと、その対策を以下に定義する。

**7.1. リスクマトリクス**

| リスク分類 | リスクシナリオ | 発生確率 | 影響度 | リスクレベル | 主な対策 |
|------------|----------------|----------|--------|-------------|----------|
| **外部依存** | ハトサポ等の画面（DOM）変更によりRPAが停止 | 中 | 高 | **高** | 定時ヘルスチェックによる早期検知・セレクタ自動再学習機能・手動CSVアップロードフォールバック |
| **外部依存** | e-Gov法令APIの仕様変更・停止 | 低 | 中 | 中 | 差分検知失敗時の警告バナー自動付記・官報PDFバックアップクロール |
| **外部依存** | OpenAI API・AWS Textractの価格改定 | 中 | 中 | 中 | 月間利用量メトリクス監視・複数AIプロバイダー対応・コスト上限アラート |
| **技術** | データベースパフォーマンス劣化 | 中 | 高 | **高** | 定期パフォーマンステスト・自動スケーリング・読み込み専用レプリカ |
| **セキュリティ** | 個人情報漏洩・不正アクセス | 低 | 極高 | **極高** | WAF・侵入検知・多要素認証・定期脆弱性診断・従業員セキュリティ教育 |
| **運用** | 提携士業のレビュー遅延 | 中 | 中 | 中 | 提携先3事務所への分散・平均応答時間監視・SLA超過アラート |
| **事業** | 協会からの公式連携要請 | 低 | 中（機会） | 低 | API公開計画の前倒し・公式連携への移行準備・RPA機能段階的廃止 |
| **災害** | データセンター障害・自然災害 | 低 | 極高 | **高** | マルチリージョンバックアップ・BCP策定・定期災害復旧訓練 |

**7.2. リスク対応戦略**

**7.2.1. 極高リスク（即座対応）**
- **個人情報漏洩リスク:** 
  - 24時間365日のセキュリティ監視
  - 年2回の外部セキュリティ診断
  - 従業員向け月次セキュリティ研修

**7.2.2. 高リスク（優先対応）**
- **RPA停止リスク:**
  - 日次ヘルスチェックとアラート設定
  - フェイルセーフ機能の実装とテスト
  - RPAからAPI移行の段階的計画

- **データベース障害リスク:**
  - 週次パフォーマンス監視レポート
  - 負荷テストの自動化
  - スケーリング閾値の調整

- **災害リスク:**
  - 月次バックアップ・リストアテスト
  - 年2回の災害復旧訓練
  - BCP（事業継続計画）の定期見直し

**7.2.3. 中リスク（計画対応）**
- **外部API変更リスク:** 変更通知の自動監視・影響度分析
- **コストリスク:** 月次コストレビュー・予算アラート設定

**7.3. リスク監視・報告**

**7.3.1. 定期監視**
- **週次:** 高リスク項目の状況確認
- **月次:** 全リスク項目の評価・対策進捗レビュー
- **四半期:** リスクマトリクスの見直し・新規リスク追加

**7.3.2. エスカレーション**
- **極高・高リスク:** 即座にCTO・CEO報告
- **中リスク:** 週次定期報告
- **低リスク:** 月次まとめ報告

**7.4. 事業継続計画（BCP）**

**7.4.1. 重要度分類**
- **最重要:** 認証・物件データ・契約書生成
- **重要:** OCR処理・外部連携・ダッシュボード
- **通常:** レポート生成・分析機能

**7.4.2. 復旧優先順位**
1. **認証システム復旧**（1時間以内）
2. **コアデータベース復旧**（2時間以内） 
3. **基幹機能復旧**（4時間以内）
4. **全機能復旧**（8時間以内）

**7.4.3. 代替手段**
- **システム全停止時:** 電話・FAXによる緊急業務継続
- **部分停止時:** 手動処理による業務継続支援
- **長期停止時:** 他社システムへの一時移行支援

